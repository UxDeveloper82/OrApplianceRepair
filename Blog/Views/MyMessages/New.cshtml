@model MyMessagesViewModel
@{
    ViewData["Title"] = "New";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section id="contact">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <h2 style="font:400 1.5em;color:black">I WOULD LIKE TO HEAR FROM YOU</h2>
                <hr class="star-primary">
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="js-tilt">
                    <img src="~/content/images/mail.png" alt="Alternate Text" />
                </div>
            </div>
            <div class="col-lg-6">
                <div class="alert">Your message has been sent</div>
                @using (Html.BeginForm("Create", "MyMessages", FormMethod.Post, new { id = "signupform" }))
                {
                    @Html.ValidationSummary(true, "Please fix the following errors")
                    <div class="form-group">
                        @Html.LabelFor(m => m.MyMessage.Name)
                        @Html.TextBoxFor(m => m.MyMessage.Name, new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.MyMessage.Name)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.MyMessage.Email)
                        @Html.TextBoxFor(m => m.MyMessage.Email, new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.MyMessage.Email)
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.MyMessage.Message)
                        @Html.TextAreaFor(m => m.MyMessage.Message, new { @class = "form-control" })
                        @Html.ValidationMessageFor(m => m.MyMessage.Message)
                    </div>
                    @Html.HiddenFor(m => m.MyMessage.Id)
                    @Html.AntiForgeryToken()
                    <button type="Submit" class="btn btn-success btn-lg">Send Message</button>
                }
            </div><!--col-lg-12-->
        </div><!--row-->
    </div><!--container-->
</section>

@section scripts {
    <script>
        let submitForm = document.querySelector("#signupform");
        submitForm.addEventListener("submit", submitData);
        function submitData(e) {
            e.preventDefault();
            //Get values
            let name, email, message;
            name = document.getElementById("MyMessage_Name").value;
            email = document.getElementById("MyMessage_Email").value;
            message = document.getElementById("MyMessage_Message").value;

              if (name == "") {
        alert("Please enter your name !!!");
              return false;
          };
          if (email == "") {
        alert("Please enter your email !!!");
              return false;
          };
          if (message == "") {
        alert("Please enter your Message !!!");
              return false;
          };

            fetch('/api/MyMessages', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: name, email: email, message: message })
            }).then((res) => res.json())
                .then((data) => {
                    submitForm.reset();
                    alert("Your message has been sent");
                })
                .catch((error) => {
                    console.error('Error', error);
                })

        }
    </script>
}
